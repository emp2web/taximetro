$(document).on("ready",function(){var lat,lon,tiempo,salir=false,pos_json=1,distm=0,unidades_dist=0;var map=document.getElementById("mapa");inicio=function(){$("#contando").hide("fast");
$("#no_se_pudo").hide("fast");$("#btn_inicio").fadeIn("slow");isStorage();};isStorage=function(){try{if(localStorage.getItem){storage=localStorage;}}catch(e){storage={};
}storage.getItem("taximetro_dist",0);storage.getItem("taximetro_time",0);storage.getItem("taximetro_pos_json",0);storage.getItem("taximetro_marcadores","");
};cordenada=function(f,d){navigator.geolocation.getCurrentPosition(function(p){if(d){dist=distancia(getLat(),getLon(),p.coords.latitude,p.coords.longitude,"m");
setDistancia(parseInt(getDistancia())+parseInt(dist));}setLat(p.coords.latitude);setLon(p.coords.longitude);eval(f);},function(){$("#contando").hide("fast");
$("#btn_inicio").hide("fast");$("#no_se_pudo").show("slow");});};setLat=function(l){lat=l;};getLat=function(){return lat;};setLon=function(l){lon=l;};getLon=function(){return lon;
};setDistancia=function(d){distm=d;storage.setItem("taximetro_dist",distm);};getDistancia=function(){return distm;};setUnidadesDist=function(){unidades_dist=(parseInt(getDistancia())/100)+25;
};getUnidadesDist=function(){return unidades_dist;};astring=function(obj){return JSON.stringify(obj);};aobj=function(str){return JSON.parse(str);};cargaInicio=function(){dato='"'+pos_json+'": {"lat":'+getLat()+',"lon":'+getLon()+',"dis": '+getDistancia()+"}";
storage.setItem("taximetro",dato);pos_json++;getMapa();$("#contando").fadeIn("slow");$("#no_se_pudo").hide("fast");$("#btn_inicio").hide("fast");setTimeout(newPos,1000);
};cargaNew=function(){dat_act=storage.getItem("taximetro");dato='"'+pos_json+'": {"lat":'+getLat()+',"lon":'+getLon()+',"dis": '+getDistancia()+"}";new_dato=dat_act+", "+dato;
storage.setItem("taximetro",new_dato);pos_json++;setUnidadesDist();};newPos=function(){if(salir){console.log("mostrar datos final");return false;}else{cordenada("cargaNew();",true);
setTimeout("newPos()",1000);}};getMapa=function(){datos=aobj("{"+storage.getItem("taximetro")+"}");marcadores=storage.getItem("taximetro_marcadores")+"&markers=color:red|"+getLat()+","+getLon();
storage.setItem("taximetro_marcadores",marcadores);pos_json==1?centro=1:centro=parseInt(pos_json/2);centro=datos[centro].lat+","+datos[centro].lon;console.log("http://maps.google.com/maps/api/staticmap?zoom=15&size=600x400&center="+centro+marcadores+"&key=AIzaSyAcZI5nuZ2dAhKw7VV0e16nrlw4F5XL_-c");
map.src="http://maps.google.com/maps/api/staticmap?zoom=15&size=600x400&center="+centro+marcadores+"&key=AIzaSyAcZI5nuZ2dAhKw7VV0e16nrlw4F5XL_-c";if(!salir){setTimeout(getMapa,2000);
}};getHora=function(){var f=new Date();return f.getHours()+":"+f.getMinutes()+":"+f.getSeconds();};getFecha=function(){var f=new Date();return f.getFullYear()+"-"+f.getMonth()+"-"+f.getDate();
};distancia=function(lat1,lon1,lat2,lon2,med){rad=function(x){return x*Math.PI/180;};var R=6378.137;var dLat=rad(lat2-lat1);var dLong=rad(lon2-lon1);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(rad(lat1))*Math.cos(rad(lat2))*Math.sin(dLong/2)*Math.sin(dLong/2);
var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;med=="m"?reto=d*1000:reto=d;return reto.toFixed(2);};inicio();$("#btn_iniciar").click(function(event){cordenada("cargaInicio();",false);
});});